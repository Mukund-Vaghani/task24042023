<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>Signup Page</title>
    <style>
        .space_div {
            margin: 12px;
        }

        input {
            margin-right: 20px;
        }

        #spanFname,
        #spanLname,
        #spanEname,
        #spanPassword {
            color: red;
            font-size: 12px;
        }
    </style>
</head>

<body onload="loadInitial()">
    <div class="d-flex align-items-center justify-content-center mt-5 ">
        <div class="border border-secondary-subtle p-5">
            <form id="student_edit_data"
                onsubmit="validation(); return false, signup(document.getElementById('role').value,document.getElementById('first_name').value,document.getElementById('last_name').value,document.getElementById('email').value,document.getElementById('gender').value, document.getElementById('password').value)">
                <h4>signup page</h4>
                <div class="space_div">
                    <label for="role">Role:</label>
                    <select name="role" id="role">
                        <option value="employee" selected="selected">Employee</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="space_div">
                    <label for="first_name">First Name :</label>
                    <input type="text" name="first_name" id="first_name" class="form-control" onchange="return (event.charCode > 64 && 
            event.charCode < 91) || (event.charCode > 96 && event.charCode < 123)" required="">
                    <span id="spanFname"></span>
                </div>
                <div class="space_div">
                    <label for="last_name">Last Name :</label>
                    <input type="text" name="last_name" id="last_name" class="form-control" onchange="return (event.charCode > 64 && 
            event.charCode < 91) || (event.charCode > 96 && event.charCode < 123)" required="">
                    <span id="spanLname"></span>
                </div>
                <div class="space_div">
                    <label for="email">Email :</label>
                    <input type="text" name="email" class="form-control" id="email" onkeyup="return validation()"
                        required="">
                    <span id="spanEname"></span>
                </div>
                <div class="space_div">
                    <label for="gender">Gender:</label>
                    <select name="gender" id="gender">
                        <option value="male" checked="checked">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="space_div">
                    <label for="password">Password :</label>
                    <input type="password" class="form-control" name="password" id="password"
                        onkeyup="return validation()">
                    <span id="spanPassword"></span>
                </div>
                <input type="submit" value="Signup" class="btn btn-secondary" />
                <!-- <button type="button" class="btn btn-secondary"
                    onclick="signup(document.getElementById('role').value,document.getElementById('first_name').value,document.getElementById('last_name').value,document.getElementById('email').value,document.getElementById('gender').value, document.getElementById('password').value)">Signup</button> -->
                <button type="button" class="btn btn-primary" onclick="login()">Login</button>
            </form>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        $(document).ready(function(){

            $("#student_edit_data").submit(function(e){
                e.preventDefault();
            });

        });


        async function signup(role, first_name, last_name, email, gender, password) {
            
            $.ajax({
                type: 'POST',
                url: 'http://localhost:8203/signup',
                headers: { 'Content-Type': 'application/json' },
                data: JSON.stringify({ role: role, first_name: first_name, last_name: last_name, email: email, gender: gender, password: password }),
                success: await function (e) {
                    if (e.code == '0') {
                        swal({
                            title: "Oops!",
                            text: "Email already exist!",
                            icon: "warning",
                        });
                    } else {
                        window.location.href = 'index.html';
                    }
                }
            })


        }

        function login() {
            window.location.href = 'index.html';
        }

        function loadInitial() {
            let user = localStorage.getItem('user');
            if (user) {
                window.location.href = 'home.html'
            }
        }

        // function validation() {
        //     event.preventDefault()

        //     let userEmail = document.getElementById('email');
        //     let userPassword = document.getElementById('password');
        //     let firstName = document.getElementById('first_name');
        //     let lastName = document.getElementById('last_name');

        //     let spanE = document.getElementById('spanEname');
        //     let spanP = document.getElementById('spanPassword');
        //     let spanF = document.getElementById('spanFname');
        //     let spanL = document.getElementById('spanLname');

        //     let eregex = /^\S+@\S+\.\S+$/;
        //     let pregex = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;

        //     if (firstName.value == "") {
        //         spanF.innerText = `Pls Fill First Name`;
        //         return false;
        //     }
        //     else {
        //         spanF.innerText = "";
        //     }

        //     if (lastName.value == "") {
        //         spanL.innerText = `Pls Fill Last Name`;
        //         return false;
        //     }
        //     else {
        //         spanL.innerText = "";
        //     }

        //     if (userEmail.value == "") {
        //         spanE.innerText = `Pls Fill Email-Address`;
        //         return false;
        //     }
        //     else if (!eregex.test(userEmail.value)) {
        //         console.log('mkddfd');
        //         spanE.innerText = 'pls Enter Valid Email';
        //         // alert("called");
        //         return false;
        //     }
        //     else {
        //         spanE.innerText = "";
        //     }

        //     if (userPassword.value == "") {
        //         spanP.innerText = `Pls Fill Password`;
        //         return false;
        //     }
        //     else if (!pregex.test(userPassword.value)) {
        //         spanP.innerText = 'pls Match the pattern';
        //         return false;
        //     }
        //     else {
        //         spanP.innerText = "";
        //     }
        // }

        function validation() {
  event.preventDefault();

  let userEmail = document.getElementById('email');
  let userPassword = document.getElementById('password');
  let firstName = document.getElementById('first_name');
  let lastName = document.getElementById('last_name');

  let spanE = document.getElementById('spanEname');
  let spanP = document.getElementById('spanPassword');
  let spanF = document.getElementById('spanFname');
  let spanL = document.getElementById('spanLname');

  let eregex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
//   let pregex = /^(?=.*?[A-Za-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-\[\]{}<>,./`~();:'"_+=|\\])/;
// let eregex = /^\S+@\S+\.\S+$/;
let pregex = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;

  if (firstName.value.trim() == "") {
    spanF.innerText = `Please fill in your first name.`;
    return false;
  } else {
    spanF.innerText = "";
  }

  if (lastName.value.trim() == "") {
    spanL.innerText = `Please fill in your last name.`;
    return false;
  } else {
    spanL.innerText = "";
  }

  if (userEmail.value.trim() == "") {
    spanE.innerText = `Please fill in your email address.`;
    return false;
  } else if (!eregex.test(userEmail.value)) {
    spanE.innerText = 'Please enter a valid email address.';
    return true;
  } else {
    spanE.innerText = "";
  }

  if (userPassword.value.trim() == "") {
    spanP.innerText = `Please fill in your password.`;
    return false;
  } else if (!pregex.test(userPassword.value)) {
    spanP.innerText = 'Please match the password pattern.';
    return false;
  } else {
    spanP.innerText = "";
  }
}

    </script>
</body>

</html>